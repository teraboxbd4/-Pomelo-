<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Click2Cash üçã </title>
    <!-- Firebase SDK, Telegram Script, Tailwind CSS, Font Awesome, Google Fonts -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Noto Sans Bengali', sans-serif; -webkit-tap-highlight-color: transparent; }
        html { height: 100%; }
        body {
            background: linear-gradient(160deg, #d3f0f1, #b3eec7);
            color: #1F2937;
            height: 100%;
            overflow: hidden;
        }
        .app-wrapper { height: 100vh; display: flex; flex-direction: column; }
        main { flex-grow: 1; overflow-y: auto; padding: 0.75rem; }
        .glass-card {
            background: rgba(255, 255, 255, 0.4);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(10px); border-top: 1px solid rgba(255, 255, 255, 0.3); display: flex; justify-content: space-around; padding: 12px 0; z-index: 100; box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.1); flex-shrink: 0; }
        .nav-item { display: flex; flex-direction: column; align-items: center; font-size: 12px; color: #64748b; transition: all 0.3s ease; padding: 8px 12px; border-radius: 16px; cursor: pointer; }
        .nav-item.active { color: #00888a; }
        .nav-item i { font-size: 20px; margin-bottom: 4px; }
        .content-section { display: none; }
        .content-section.active { display: block; animation: fadeIn 0.5s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        #loader { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(160deg, #d3f0f1, #b3eec7); z-index: 9999; display: flex; flex-direction: column; justify-content: center; align-items: center; transition: opacity 0.5s ease; }
        .loader-spinner { border: 5px solid rgba(0, 0, 0, 0.1); border-top: 5px solid #00888a; border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* New Home Page Styles */
        .balance-card {
            background-color: #79d7c6;
            color: #216a61;
            padding: 20px;
            border-radius: 18px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .balance-card .app-title { font-size: 1.5rem; font-weight: 700; color: #13524a; }
        .balance-card .app-subtitle { font-size: 0.9rem; }
        .balance-card .user-info { text-align: right; }
        .balance-card .user-name { font-weight: 600; }
        .balance-card .user-balance { font-size: 1.1rem; font-weight: 500; }

        .withdraw-button-large {
            width: 100%;
            background: linear-gradient(135deg, #26c6da, #00acb1);
            color: white;
            padding: 14px;
            border-radius: 16px;
            font-size: 1.1rem;
            font-weight: 600;
            border: none;
            margin-top: 1rem;
            box-shadow: 0 4px 15px rgba(0, 172, 177, 0.4);
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
        }

        .action-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 1rem; }
        .action-card {
            background: rgba(255, 255, 255, 0.5);
            border-radius: 18px;
            padding: 16px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.6);
        }
        .action-card .action-icon { font-size: 2.2rem; color: #008d8e; margin-bottom: 8px; }
        .action-card .action-title { font-weight: 600; font-size: 1rem; color: #1f2937; }
        .action-card .action-subtitle { font-size: 0.8rem; color: #4b5563; margin-top: 4px; line-height: 1.3; }

        .activity-card {
            background: rgba(255, 255, 255, 0.5);
            border-radius: 18px;
            padding: 16px;
            margin-top: 1rem;
             border: 1px solid rgba(255, 255, 255, 0.6);
        }
        .activity-card h3 { font-size: 1.1rem; font-weight: 600; display: flex; align-items: center; gap: 8px; color: #1e3a8a; }
        .activity-card #recent-activity { margin-top: 12px; }
        .activity-item { display: flex; justify-content: space-between; align-items: center; padding: 10px 4px; border-bottom: 1px solid rgba(0,0,0,0.05); }
        .activity-item:last-child { border-bottom: none; }
        .activity-item .title { font-weight: 500; }
        .activity-item .date { font-size: 0.75rem; color: #6b7280; }
        .activity-item .amount { font-weight: 700; color: #16a34a; }
        .activity-message { color: #ef4444; font-weight: 500; text-align: center; padding: 10px; }

        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 1000; justify-content: center; align-items: center; backdrop-filter: blur(5px); }
        .modal-content { background: rgba(255, 255, 255, 0.9); border-radius: 20px; padding: 24px; width: 90%; max-width: 400px; border: 1px solid rgba(255, 255, 255, 0.3); }
        input, select { background: rgba(255, 255, 255, 0.7) !important; border-radius: 12px !important; border: 1px solid rgba(200, 200, 200, 0.8) !important; }

        #tasks-list .task-card { display: flex; align-items: center; justify-content: space-between; padding: 12px; }
        #tasks-list .task-card-icon { font-size: 28px; color: #008d8e; margin-right: 12px; }
        .btn-primary { background: linear-gradient(135deg, #00CED1, #20B2AA); color: white; border-radius: 16px; padding: 14px 24px; font-weight: bold; transition: all 0.3s ease; border: none; }
        .btn-primary:disabled { background: #999; opacity: 0.7; cursor: not-allowed; }
    </style>
</head>
<body>
    <div id="loader">
        <div class="loader-spinner"></div>
    </div>

    <div id="auth-section" class="flex justify-center items-center min-h-screen p-5" style="display: none;">
        <div class="glass-card w-full max-w-md p-8">
            <div id="login-form">
                <h2 class="text-2xl font-bold mb-6 text-center">‡¶≤‡¶ó ‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
                <form id="login-form-element">
                    <div class="mb-4"><label class="block mb-2">‡¶á‡¶Æ‡ßá‡¶á‡¶≤</label><input type="email" id="login-email" class="w-full p-3" required></div>
                    <div class="mb-4"><label class="block mb-2">‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°</label><input type="password" id="login-password" class="w-full p-3" required></div>
                    <div class="text-right mb-6"><a href="#" id="forgot-password-link" class="text-sm text-cyan-600 hover:underline">‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶≠‡ßÅ‡¶≤‡ßá ‡¶ó‡ßá‡¶õ‡ßá‡¶®?</a></div>
                    <button type="submit" class="btn-primary w-full py-3 mb-4">‡¶≤‡¶ó ‡¶á‡¶®</button>
                </form>
                <p class="text-center">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶®‡ßá‡¶á? <a href="#" id="show-register" class="text-cyan-600 hover:underline">‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®</a></p>
            </div>
            <div id="register-form" class="hidden">
                <h2 class="text-2xl font-bold mb-6 text-center">‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
                <form id="register-form-element">
                    <div class="mb-4"><label class="block mb-2">‡¶™‡ßÅ‡¶∞‡ßã ‡¶®‡¶æ‡¶Æ</label><input type="text" id="register-name" class="w-full p-3" required></div>
                    <div class="mb-4"><label class="block mb-2">‡¶á‡¶Æ‡ßá‡¶á‡¶≤</label><input type="email" id="register-email" class="w-full p-3" required></div>
                    <div class="mb-4"><label class="block mb-2">‡¶´‡ßã‡¶® ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞</label><input type="tel" id="register-phone" class="w-full p-3" required></div>
                    <div class="mb-4"><label class="block mb-2">‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°</label><input type="password" id="register-password" class="w-full p-3" required></div>
                    <div class="mb-6"><label class="block mb-2">‡¶ï‡¶®‡¶´‡¶æ‡¶∞‡ßç‡¶Æ ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°</label><input type="password" id="register-confirm-password" class="w-full p-3" required></div>
                    <button type="submit" class="btn-primary w-full py-3 mb-4">‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞</button>
                </form>
                <p class="text-center">‡¶á‡¶§‡¶ø‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶Ü‡¶õ‡ßá? <a href="#" id="show-login" class="text-cyan-600 hover:underline">‡¶≤‡¶ó ‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</a></p>
            </div>
        </div>
    </div>

    <div id="main-app" class="hidden app-wrapper">
        <main>
            <div class="pb-24"> 
                <section id="home" class="content-section active">
                    <!-- START: New UI from Image -->
                    <div class="balance-card">
                        <div>
                            <h1 class="app-title">‡¶∏‡¶¨‡ßÅ‡¶ú ‡¶Æ‡¶∞‡¶ø‡¶ö</h1>
                            <p class="app-subtitle">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶á‡¶®‡¶ï‡¶æ‡¶Æ‡ßá‡¶∞ ‡¶™‡¶•</p>
                        </div>
                        <div class="user-info">
                            <p class="user-name" id="header-user-name">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>
                            <p class="user-balance">‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏: ‡ß≥<span id="header-balance">0.00</span></p>
                        </div>
                    </div>
                    
                    <button id="withdraw-btn-home" class="withdraw-button-large">
                        <i class="fas fa-wallet"></i> ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶§‡ßÅ‡¶≤‡ßÅ‡¶®
                    </button>

                    <div class="action-grid">
                        <button id="watch-ad-btn" class="action-card">
                            <i class="fas fa-video action-icon"></i>
                            <p class="action-title">‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</p>
                            <p class="action-subtitle">‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶è ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶•‡ßá‡¶ï‡ßá ‡ß≥5.00 ‡¶Ü‡¶Ø‡¶º ‡¶ï‡¶∞‡ßÅ‡¶®</p>
                        </button>
                        <button data-target="tasks" class="nav-btn action-card">
                            <i class="fas fa-list-check action-icon"></i>
                            <p class="action-title">‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®</p>
                            <p class="action-subtitle">‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶•‡ßá‡¶ï‡ßá ‡ß´-‡ßß‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶Ü‡¶Ø‡¶º ‡¶ï‡¶∞‡ßÅ‡¶®</p>
                        </button>
                        <button data-target="spin" class="nav-btn action-card">
                            <i class="fas fa-dharmachakra action-icon"></i>
                            <p class="action-title">‡¶∏‡ßç‡¶™‡¶ø‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</p>
                            <p class="action-subtitle">‡¶∏‡ßç‡¶™‡¶ø‡¶® ‡¶ï‡¶∞‡ßá ‡ßß-‡ß®‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶™‡ßÅ‡¶∞‡¶∏‡ßç‡¶ï‡¶æ‡¶∞ ‡¶ú‡¶ø‡¶§‡ßÅ‡¶®</p>
                        </button>
                        <button data-target="profile" class="nav-btn action-card">
                            <i class="fas fa-user-plus action-icon"></i>
                            <p class="action-title">‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®</p>
                            <p class="action-subtitle">‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá ‡ß≥40 ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶™‡¶æ‡¶®</p>
                        </button>
                    </div>

                    <div class="activity-card">
                        <h3><i class="fas fa-history"></i> ‡¶∏‡¶æ‡¶Æ‡ßç‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ï ‡¶ï‡¶æ‡¶∞‡ßç‡¶Ø‡¶ï‡ßç‡¶∞‡¶Æ</h3>
                        <div id="recent-activity">
                             <p class="activity-message" style="color: #6b7280;">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>
                        </div>
                    </div>
                    <!-- END: New UI from Image -->
                </section>
                <section id="tasks" class="content-section"><div class="glass-card p-4"><h2 class="text-2xl font-bold mb-4 text-center"><i class="fas fa-tasks mr-3 text-cyan-500"></i>‡¶°‡ßá‡¶á‡¶≤‡¶ø ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï</h2><div id="tasks-list" class="space-y-3"></div></div></section>
                <section id="spin" class="content-section"><div class="glass-card p-6 text-center"><h2 class="text-2xl font-bold mb-2">‡¶∏‡ßç‡¶™‡¶ø‡¶® ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶Ø‡¶º ‡¶ï‡¶∞‡ßÅ‡¶®</h2><p class="mb-4">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶∏‡ßç‡¶™‡¶ø‡¶®: <span id="spins-left">3</span>/<span id="daily-spin-limit-text">3</span></p><div class="wheel-container"><div class="wheel-outer-border"><div class="wheel-inner-border"><div class="wheel" id="wheel"></div></div></div><div class="wheel-center"></div><div class="wheel-pointer"></div></div><button id="spin-wheel-btn" class="btn-primary w-full py-3 text-lg mt-4">‡¶∏‡ßç‡¶™‡¶ø‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</button></div></section>
                <section id="wallet" class="content-section">
                    <div class="glass-card p-6"><div class="mb-6"><h3 class="text-xl font-bold mb-4">‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®‡ßá‡¶∞ ‡¶∂‡¶∞‡ßç‡¶§‡¶æ‡¶¨‡¶≤‡ßÄ</h3><div id="withdrawal-conditions" class="space-y-2 p-4 bg-white/50 rounded-lg"></div></div><h2 class="text-2xl font-bold mb-4"><i class="fas fa-wallet mr-3 text-cyan-500"></i>‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶ì‡¶Ø‡¶º‡¶æ‡¶≤‡ßá‡¶ü</h2><div class="mb-4 p-4 bg-cyan-100 rounded-xl text-gray-800"><p>‡¶Æ‡ßã‡¶ü ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏</p><p class="text-4xl font-bold my-2">‡ß≥<span id="wallet-total">0.00</span></p><p class="text-sm">‡¶®‡ßç‡¶Ø‡ßÇ‡¶®‡¶§‡¶Æ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®: ‡ß≥<span id="min-withdrawal-text">50.00</span></p></div><div id="wallet-notice" class="mb-6 p-4 bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 rounded-lg"></div><div class="space-y-4 mb-6"><div class="flex justify-between items-center p-3 bg-white/70 rounded-lg"><div><p class="font-semibold">‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶Ü‡¶Ø‡¶º</p></div><p class="text-xl font-bold text-green-500">‡ß≥<span id="wallet-today">0.00</span></p></div><div class="flex justify-between items-center p-3 bg-white/70 rounded-lg"><div><p class="font-semibold">‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶Ü‡¶Ø‡¶º</p></div><p class="text-xl font-bold text-cyan-500">‡ß≥<span id="wallet-referral">0.00</span></p></div></div><button id="wallet-withdraw-btn" class="btn-primary w-full py-3 mb-8"><i class="fas fa-money-bill-wave mr-2"></i> ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</button><div><h3 class="text-xl font-bold mb-4">‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®‡ßá‡¶∞ ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡¶ø</h3><div id="withdrawal-history" class="space-y-3"></div></div></div>
                </section>
                <section id="profile" class="content-section">
                    <div class="glass-card p-4">
                        <div class="flex items-center space-x-4">
                            <div class="profile-pic-container">
                                <img id="profile-pic-img" src="https://i.ibb.co/6y4n3SM/default-avatar.png" alt="Profile Picture" class="profile-pic">
                            </div>
                            <div class="flex-grow">
                                <div id="name-display-container" class="flex items-center">
                                    <h2 id="profile-name-text" class="text-xl font-bold text-gray-800"></h2>
                                    <i id="edit-name-btn" class="fas fa-pencil-alt ml-3 text-sm text-gray-600 cursor-pointer hover:text-cyan-600"></i>
                                </div>
                                <div id="name-edit-container" class="hidden">
                                    <input type="text" id="profile-name-input" class="w-full text-xl font-bold p-1 border rounded-md">
                                    <button id="save-name-btn" class="btn-primary py-1 px-3 mt-1 text-sm">‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                                </div>
                                <p id="profile-email-display" class="text-sm text-gray-700 mt-1 font-medium"></p>
                                <p id="profile-phone-display" class="text-sm text-gray-700 mt-1 font-medium"></p>
                                <p id="profile-join-date" class="text-xs text-gray-600 mt-1"></p>
                            </div>
                        </div>
                    </div>
                    <div class="glass-card p-6 mt-6">
                         <div class="p-4 bg-white/70 rounded-lg mb-6"><p class="mb-1">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï</p><div class="flex"><input type="text" id="referral-link" class="flex-grow p-2 bg-gray-100 rounded-l-lg" readonly><button id="copy-link" class="bg-cyan-500 text-white px-4 rounded-r-lg"><i class="fas fa-copy"></i></button></div></div>
                        <div class="grid grid-cols-2 gap-4 mb-6"><div class="p-3 bg-white/70 rounded-lg text-center"><p class="text-2xl font-bold text-cyan-500" id="profile-tasks">0</p><p>‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï</p></div><div class="p-3 bg-white/70 rounded-lg text-center"><p class="text-2xl font-bold text-green-500" id="profile-referrals">0</p><p>‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤</p></div></div>
                        <button id="logout-btn" class="w-full py-3 bg-red-500 hover:bg-red-600 text-white rounded-lg font-bold">‡¶≤‡¶ó ‡¶Ü‡¶â‡¶ü</button>
                    </div>
                </section>
            </div>
        </main>
        <nav class="bottom-nav flex-shrink-0"><a class="nav-item active" data-section="home"><i class="fas fa-home"></i><span>‡¶π‡ßã‡¶Æ</span></a><a class="nav-item" data-section="tasks"><i class="fas fa-list-check"></i><span>‡¶ü‡¶æ‡¶∏‡ßç‡¶ï</span></a><a class="nav-item" data-section="spin"><i class="fas fa-dharmachakra"></i><span>‡¶∏‡ßç‡¶™‡¶ø‡¶®</span></a><a class="nav-item" data-section="wallet"><i class="fas fa-wallet"></i><span>‡¶ì‡¶Ø‡¶º‡¶æ‡¶≤‡ßá‡¶ü</span></a><a class="nav-item" data-section="profile"><i class="fas fa-user"></i><span>‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤</span></a></nav>
    </div>
        
    <div id="withdraw-modal" class="modal"><div class="modal-content"><h2 class="text-xl font-bold mb-4 text-center">‡¶ü‡¶æ‡¶ï‡¶æ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</h2><form id="withdraw-form"><div class="mb-4"><label class="block mb-2">‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶Æ‡ßá‡¶•‡¶°</label><select id="withdraw-method" class="w-full p-3"><option>bKash</option><option>Nagad</option><option>Rocket</option></select></div><div class="mb-4"><label class="block mb-2">‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞</label><input type="text" id="withdraw-number" class="w-full p-3" required></div><div class="mb-4"><label class="block mb-2">‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ (‡ß≥)</label><input type="number" step="0.01" id="withdraw-amount" class="w-full p-3" placeholder="‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®" required></div><div class="flex justify-between mt-6"><button type="button" id="cancel-withdraw" class="px-4 py-2 bg-gray-500 text-gray-800 rounded-lg">‡¶¨‡¶æ‡¶§‡¶ø‡¶≤</button><button type="submit" class="px-4 py-2 bg-green-500 text-white rounded-lg">‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶®</button></div></form></div></div>

    <script>
        const firebaseConfig = { apiKey: "AIzaSyBowdaBVkAZa7OLr0wmJxjn9JqSlsy7l5o", authDomain: "pomelo-50690.firebaseapp.com", projectId: "pomelo-50690", storageBucket: "pomelo-50690.firebasestorage.app", messagingSenderId: "687340787607", appId: "1:687340787607:web:5c2fe2d6d0ff09c6c956d2" };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        let currentUser = null, userData = null, userListener = null, adSettings = [], spinAdSettings = [], taskAdSettings = [], appSettings = {};
        let spinPrizes = [];
        let presenceInterval = null;
        
        const loader = document.getElementById('loader');
        const showLoader = () => loader.style.display = 'flex';
        const hideLoader = () => { loader.style.opacity = '0'; setTimeout(() => { loader.style.display = 'none'; }, 500); };
        const showAuthSection = () => { document.getElementById('auth-section').style.display = 'flex'; document.getElementById('main-app').style.display = 'none'; hideLoader(); };
        const showMainApp = () => {
            document.getElementById('auth-section').style.display = 'none';
            document.getElementById('main-app').style.display = 'flex';
            hideLoader();
        };
        const switchToRegister = () => { document.getElementById('login-form').classList.add('hidden'); document.getElementById('register-form').classList.remove('hidden'); };
        const switchToLogin = () => { document.getElementById('register-form').classList.add('hidden'); document.getElementById('login-form').classList.remove('hidden'); };

        async function loadAppSettings() { 
            const doc = await db.collection('app_settings').doc('config').get(); 
            const defaults = { 
                minWithdrawal: 50, joiningBonus: 10, referralBonus: 5, dailySpins: 3, watchAdReward: 5, 
                dailyAdLimit: 10, hourlyAdLimit: 2,
                spinPrizes: [3, 2, 5, 8, 10, 15, 20, 1],
                minReferrals: 10, minBalance: 1000, 
            }; 
            appSettings = doc.exists ? { ...defaults, ...doc.data() } : defaults; 
            spinPrizes = appSettings.spinPrizes; 
            generateWheelSections(); 
        }

        function generateWheelSections() { const wheel = document.getElementById('wheel'); if (!wheel) return; wheel.innerHTML = ''; const colors = ['#3498db', '#e67e22', '#2ecc71', '#9b59b6', '#f1c40f', '#e74c3c', '#1abc9c', '#34495e']; const angle = 360 / (spinPrizes.length || 8); spinPrizes.forEach((prize, index) => { const section = document.createElement('div'); section.className = 'wheel-section'; section.style.background = colors[index % colors.length]; section.style.transform = `rotate(${index * angle}deg)`; section.innerHTML = `<span style="transform: rotate(${angle / 2}deg) translateY(-100%)">${'‡ß≥' + prize}</span>`; wheel.appendChild(section); }); }
        
        async function initializeUserData(user) {
            const userRef = db.collection('users').doc(user.uid);
            const userDoc = await userRef.get();
            if (userDoc.exists) return userDoc.data();
            
            let ref = null;
            try {
                if (window.Telegram && window.Telegram.WebApp && window.Telegram.WebApp.initDataUnsafe) { 
                    const initData = new URLSearchParams(window.Telegram.WebApp.initData); 
                    if (initData.has('start_param')) { ref = initData.get('start_param'); }
                } 
            } catch(e) { console.error("Could not read Telegram data:", e); }
            if (!ref) { ref = new URLSearchParams(window.location.search).get('ref'); }
            
            const joiningBonus = ref ? (appSettings.joiningBonus || 0) : 0;
            const newUserData = {
                uid: user.uid, email: user.email, name: document.getElementById('register-name').value || user.displayName || '‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ',
                phone: document.getElementById('register-phone').value || '', balance: joiningBonus, todayEarnings: 0, totalEarnings: joiningBonus, 
                referralEarnings: 0, adWatchTimestamps: [], 
                tasksCompleted: [], spinsUsed: 0, lastSpinDate: null, referrals: 0, 
                joinDate: new Date().toISOString(), referredBy: ref || null, isBanned: false,
                lastSeen: firebase.firestore.FieldValue.serverTimestamp()
            };
            await userRef.set(newUserData);

            if (ref) {
                const referrerRef = db.collection('users').doc(ref);
                const referralBonus = appSettings.referralBonus || 0;
                await db.runTransaction(async (transaction) => {
                    const doc = await transaction.get(referrerRef);
                    if (doc.exists) {
                        transaction.update(referrerRef, {
                            balance: firebase.firestore.FieldValue.increment(referralBonus),
                            referralEarnings: firebase.firestore.FieldValue.increment(referralBonus),
                            referrals: firebase.firestore.FieldValue.increment(1)
                        });
                    }
                });
                
                if (joiningBonus > 0) await addActivity('‡¶ú‡ßü‡ßá‡¶®‡¶ø‡¶Ç ‡¶¨‡ßã‡¶®‡¶æ‡¶∏', joiningBonus);
                if (referralBonus > 0) {
                    const newUserName = newUserData.name || '‡¶®‡¶§‡ßÅ‡¶® ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ';
                    await addActivity(`'${newUserName}' ‡¶•‡ßá‡¶ï‡ßá ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶¨‡ßã‡¶®‡¶æ‡¶∏`, referralBonus, ref);
                    await addNotification('‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶¨‡ßã‡¶®‡¶æ‡¶∏!', `‡¶Ü‡¶™‡¶®‡¶ø '${newUserName}' ‡¶ï‡ßá ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡ß≥${referralBonus} ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶™‡ßá‡ßü‡ßá‡¶õ‡ßá‡¶®‡•§`, ref);
                }
            }
            return newUserData;
        }
        
        const updateUserPresence = () => {
            if (currentUser) {
                db.collection('users').doc(currentUser.uid).update({
                    lastSeen: firebase.firestore.FieldValue.serverTimestamp()
                }).catch(err => {});
            }
        };
        
        const listenToUserData = (uid) => { if (userListener) userListener(); userListener = db.collection('users').doc(uid).onSnapshot((doc) => { if (doc.exists) { userData = doc.data(); updateAllUI(); } else { auth.signOut(); } }); };
        
        async function addActivity(title, amount, forUserId = null) { if (amount > 0) { await db.collection('activities').add({ userId: forUserId || currentUser.uid, title, amount, timestamp: new Date().toISOString() }); } }
        async function addNotification(title, message, forUserId = null) { await db.collection('notifications').add({ userId: forUserId || currentUser.uid, title, message, timestamp: new Date().toISOString(), read: false }); }

        function updateAllUI() {
            if (!userData) return;
            const balance = (userData.balance || 0).toFixed(2);
            document.getElementById('header-balance').textContent = balance;
            document.getElementById('wallet-total').textContent = balance;
            document.getElementById('header-user-name').textContent = userData.name || '‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ';
            
            document.getElementById('wallet-today').textContent = (userData.todayEarnings || 0).toFixed(2);
            document.getElementById('wallet-referral').textContent = (userData.referralEarnings || 0).toFixed(2);
            
            document.getElementById('profile-pic-img').src = userData.photo_url || 'https://i.ibb.co/6y4n3SM/default-avatar.png';
            document.getElementById('profile-name-text').textContent = userData.name || '‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ';
            document.getElementById('profile-email-display').textContent = `‡¶á‡¶Æ‡ßá‡¶á‡¶≤: ${userData.email || 'N/A'}`;
            document.getElementById('profile-phone-display').textContent = `‡¶´‡ßã‡¶®: ${userData.phone || 'N/A'}`;
            if(userData.joinDate) { document.getElementById('profile-join-date').textContent = `‡¶Ø‡ßã‡¶ó‡¶¶‡¶æ‡¶®: ${new Date(userData.joinDate).toLocaleDateString('bn-BD')}`; }
            
            let referralLink = `${window.location.origin}${window.location.pathname}?ref=${currentUser.uid}`;
            document.getElementById('referral-link').value = referralLink;
            document.getElementById('profile-tasks').textContent = (userData.tasksCompleted || []).filter(key => key.endsWith(new Date().toDateString())).length;
            document.getElementById('profile-referrals').textContent = userData.referrals || 0;
            
            document.getElementById('min-withdrawal-text').textContent = (appSettings.minWithdrawal || 50).toFixed(2);
            if(document.getElementById('wallet-notice')) document.getElementById('wallet-notice').textContent = appSettings.walletNotice || '';
            
            const conditionsContainer = document.getElementById('withdrawal-conditions');
            const userReferrals = userData.referrals || 0; const userBalance = userData.balance || 0; const minReferrals = appSettings.minReferrals || 0; const minBalance = appSettings.minBalance || 0; const referralsMet = userReferrals >= minReferrals; const balanceMet = userBalance >= minBalance;
            conditionsContainer.innerHTML = `<p class="flex justify-between"><span>‡¶®‡ßç‡¶Ø‡ßÇ‡¶®‡¶§‡¶Æ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤:</span><span class="${referralsMet ? 'text-green-600' : 'text-red-600'} font-bold">${userReferrals} / ${minReferrals} ${referralsMet ? '<i class="fas fa-check-circle"></i>' : '<i class="fas fa-times-circle"></i>'}</span></p><p class="flex justify-between"><span>‡¶®‡ßç‡¶Ø‡ßÇ‡¶®‡¶§‡¶Æ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏:</span><span class="${balanceMet ? 'text-green-600' : 'text-red-600'} font-bold">‡ß≥${userBalance.toFixed(2)} / ‡ß≥${minBalance.toFixed(2)} ${balanceMet ? '<i class="fas fa-check-circle"></i>' : '<i class="fas fa-times-circle"></i>'}</span></p>`;
            
            const today = new Date().toDateString();
            if (userData.lastSpinDate !== today) { db.collection('users').doc(currentUser.uid).update({ spinsUsed: 0, lastSpinDate: today }); }
            const spinsUsed = userData.spinsUsed || 0;
            document.getElementById('spins-left').textContent = (appSettings.dailySpins || 3) - spinsUsed;
            document.getElementById('spin-wheel-btn').disabled = spinsUsed >= (appSettings.dailySpins || 3);
            
            updateRecentActivities();
        }
        
        async function updateRecentActivities() {
            const container = document.getElementById('recent-activity');
            if (!currentUser || !container) return;
            try {
                const snapshot = await db.collection('activities').where('userId', '==', currentUser.uid).orderBy('timestamp', 'desc').limit(5).get();
                if (snapshot.empty) {
                    container.innerHTML = '<p class="activity-message" style="color: #6b7280;">‡¶ï‡ßã‡¶®‡ßã ‡¶∏‡¶æ‡¶Æ‡ßç‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ï ‡¶ï‡¶æ‡¶∞‡ßç‡¶Ø‡¶ï‡ßç‡¶∞‡¶Æ ‡¶®‡ßá‡¶á‡•§</p>';
                    return;
                }
                container.innerHTML = '';
                snapshot.docs.forEach(doc => {
                    const act = doc.data();
                    container.innerHTML += `
                        <div class="activity-item">
                            <div>
                                <p class="title">${act.title}</p>
                                <p class="date">${new Date(act.timestamp).toLocaleString('bn-BD')}</p>
                            </div>
                            <p class="amount">+‡ß≥${act.amount.toFixed(2)}</p>
                        </div>`;
                });
            } catch (error) {
                console.error("Error loading recent activities:", error);
                container.innerHTML = '<p class="activity-message">‡¶ï‡¶æ‡¶∞‡ßç‡¶Ø‡¶ï‡ßç‡¶∞‡¶Æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§</p>';
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('edit-name-btn').addEventListener('click', () => { document.getElementById('name-display-container').classList.add('hidden'); document.getElementById('name-edit-container').classList.remove('hidden'); document.getElementById('profile-name-input').value = userData.name; document.getElementById('profile-name-input').focus(); });
            document.getElementById('save-name-btn').addEventListener('click', async () => { const newName = document.getElementById('profile-name-input').value.trim(); if (!newName) return; const btn = document.getElementById('save-name-btn'); btn.disabled = true; try { await db.collection('users').doc(currentUser.uid).update({ name: newName }); } catch (error) {} finally { document.getElementById('name-edit-container').classList.add('hidden'); document.getElementById('name-display-container').classList.remove('hidden'); btn.disabled = false; } });
            
            document.getElementById('show-register').addEventListener('click', (e) => { e.preventDefault(); switchToRegister(); });
            document.getElementById('show-login').addEventListener('click', (e) => { e.preventDefault(); switchToLogin(); });
            document.getElementById('login-form-element').addEventListener('submit', async (e) => { e.preventDefault(); const btn = e.target.querySelector('button[type="submit"]'); btn.disabled = true; try { await auth.signInWithEmailAndPassword(document.getElementById('login-email').value, document.getElementById('login-password').value); } catch (err) { alert('‡¶≤‡¶ó ‡¶á‡¶® ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•‡•§'); } finally { btn.disabled = false; } });
            document.getElementById('register-form-element').addEventListener('submit', async (e) => { e.preventDefault(); const btn = e.target.querySelector('button[type="submit"]'); btn.disabled = true; const password = document.getElementById('register-password').value; const confirmPassword = document.getElementById('register-confirm-password').value; if (password !== confirmPassword) { alert("‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶Æ‡ßá‡¶≤‡ßá‡¶®‡¶ø‡•§"); btn.disabled = false; return; } try { const cred = await auth.createUserWithEmailAndPassword(document.getElementById('register-email').value, password); await cred.user.updateProfile({ displayName: document.getElementById('register-name').value }); } catch (err) { alert('‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶® ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•‡•§'); } finally { btn.disabled = false; } });
            
            const sections = document.querySelectorAll('.content-section'), navItems = document.querySelectorAll('.nav-item'), navButtons = document.querySelectorAll('.nav-btn'); function navigateTo(sectionId) { sections.forEach(s => s.classList.remove('active')); document.getElementById(sectionId)?.classList.add('active'); navItems.forEach(n => n.classList.toggle('active', n.dataset.section === sectionId)); }
            [...navItems, ...navButtons].forEach(item => item.addEventListener('click', (e) => { e.preventDefault(); navigateTo(item.dataset.target || item.dataset.section); }));

            document.getElementById('watch-ad-btn').addEventListener('click', async function() { 
                this.disabled = true; 
                const now = new Date(); const oneHourAgo = new Date(now.getTime() - 60 * 60 * 1000); const todayStr = now.toDateString();
                const adTimestamps = (userData.adWatchTimestamps || []).map(ts => ts.toDate());
                let dailyCount = (userData.lastAdWatchDate === todayStr) ? (userData.adsCompletedToday || 0) : 0;
                const hourlyCount = adTimestamps.filter(ts => ts > oneHourAgo).length;

                if (dailyCount >= appSettings.dailyAdLimit) { alert(`‡¶Ü‡¶™‡¶®‡¶ø ‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ (${appSettings.dailyAdLimit}) ‡¶ü‡¶ø ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡ßá ‡¶´‡ßá‡¶≤‡ßá‡¶õ‡ßá‡¶®‡•§`); this.disabled = false; return; }
                if (hourlyCount >= appSettings.hourlyAdLimit) { alert(`‡¶Ü‡¶™‡¶®‡¶ø ‡¶è‡¶á ‡¶ò‡¶£‡ßç‡¶ü‡¶æ‡ßü (${appSettings.hourlyAdLimit}) ‡¶ü‡¶ø ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡ßá ‡¶´‡ßá‡¶≤‡ßá‡¶õ‡ßá‡¶®‡•§`); this.disabled = false; return; }

                try { 
                    const rewardAmount = appSettings.watchAdReward || 0; 
                    if (rewardAmount > 0) { 
                        const inc = firebase.firestore.FieldValue.increment; 
                        await db.collection('users').doc(currentUser.uid).update({ 
                            balance: inc(rewardAmount), todayEarnings: inc(rewardAmount), totalEarnings: inc(rewardAmount), adsCompleted: inc(1),
                            adWatchTimestamps: firebase.firestore.FieldValue.arrayUnion(firebase.firestore.Timestamp.now()),
                            adsCompletedToday: inc(1), lastAdWatchDate: todayStr
                        }); 
                        await addActivity('‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡¶æ', rewardAmount); 
                        alert(`‡¶ß‡¶®‡ßç‡¶Ø‡¶¨‡¶æ‡¶¶! ‡ß≥${rewardAmount.toFixed(2)} ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§`); 
                    } 
                } catch (e) { alert('‡¶è‡¶ï‡¶ü‡¶ø ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§'); } finally { this.disabled = false; } 
            });

            const withdrawModal = document.getElementById('withdraw-modal');
            const showWithdrawModal = () => { withdrawModal.style.display = 'flex'; };
            document.getElementById('withdraw-btn-home').addEventListener('click', showWithdrawModal);
            document.getElementById('wallet-withdraw-btn')?.addEventListener('click', showWithdrawModal);
            document.getElementById('cancel-withdraw').addEventListener('click', () => withdrawModal.style.display = 'none');
            document.getElementById('withdraw-form').addEventListener('submit', async (e) => { e.preventDefault(); const amount = parseFloat(document.getElementById('withdraw-amount').value); const method = document.getElementById('withdraw-method').value; const number = document.getElementById('withdraw-number').value; const userReferrals = userData.referrals || 0; const userBalance = userData.balance || 0; const minReferrals = appSettings.minReferrals || 0; const minBalanceForWithdrawal = appSettings.minBalance || 0; const minWithdrawalAmount = appSettings.minWithdrawal || 50; let errorMessages = []; if (userReferrals < minReferrals) { errorMessages.push(`‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá ${minReferrals}‡¶ü‡¶ø ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®‡•§`); } if (userBalance < minBalanceForWithdrawal) { errorMessages.push(`‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá ‡ß≥${minBalanceForWithdrawal.toFixed(2)} ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§`); } if (isNaN(amount) || amount <= 0) { errorMessages.push(`‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶∏‡¶†‡¶ø‡¶ï ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®‡•§`); } if (amount < minWithdrawalAmount) { errorMessages.push(`‡¶Ü‡¶™‡¶®‡¶ø ‡¶∏‡¶∞‡ßç‡¶¨‡¶®‡¶ø‡¶Æ‡ßç‡¶® ‡ß≥${minWithdrawalAmount.toFixed(2)} ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®‡•§`); } if (amount > userBalance) { errorMessages.push(`‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü‡ßá ‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶§ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶®‡ßá‡¶á‡•§`); } if (errorMessages.length > 0) { alert("‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶ï‡¶∞‡¶æ ‡¶∏‡¶Æ‡ßç‡¶≠‡¶¨ ‡¶®‡ßü:\n\n" + errorMessages.join("\n")); return; } const btn = e.target.querySelector('button[type="submit"]'); btn.disabled = true; try { await db.runTransaction(async (t) => { const userRef = db.collection('users').doc(currentUser.uid); const withdrawalRef = db.collection('withdrawals').doc(); const userDoc = await t.get(userRef); if (!userDoc.exists || userDoc.data().balance < amount) throw "Insufficient balance!"; t.set(withdrawalRef, { userId: currentUser.uid, userName: userData.name, amount, method, number, status: 'pending', timestamp: new Date().toISOString() }); t.update(userRef, { balance: firebase.firestore.FieldValue.increment(-amount) }); }); withdrawModal.style.display = 'none'; document.getElementById('withdraw-form').reset(); alert('‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®‡ßá‡¶∞ ‡¶Ö‡¶®‡ßÅ‡¶∞‡ßã‡¶ß ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!'); } catch (error) { alert('‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®‡ßá‡¶∞ ‡¶Ö‡¶®‡ßÅ‡¶∞‡ßã‡¶ß ‡¶™‡¶æ‡¶†‡¶æ‡¶§‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§'); } finally { btn.disabled = false; } });
            
            document.getElementById('copy-link').addEventListener('click', () => navigator.clipboard.writeText(document.getElementById('referral-link').value).then(() => alert('‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!')));
            document.getElementById('logout-btn').addEventListener('click', () => auth.signOut());
        });

        auth.onAuthStateChanged(async (user) => {
            if (user) {
                currentUser = user;
                await loadAppSettings();
                userData = await initializeUserData(user);
                
                updateUserPresence();
                if(presenceInterval) clearInterval(presenceInterval);
                presenceInterval = setInterval(updateUserPresence, 2 * 60 * 1000); 

                if (userData.isBanned) { alert('‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü‡¶ü‡¶ø ‡¶∏‡¶æ‡¶∏‡¶™‡ßá‡¶®‡ßç‡¶° ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§'); auth.signOut(); return; }
                showMainApp();
                listenToUserData(user.uid);
            } else {
                currentUser = null; userData = null; if (userListener) userListener();
                if(presenceInterval) clearInterval(presenceInterval); 
                showAuthSection();
            }
        });
    </script>
</body>
</html>
