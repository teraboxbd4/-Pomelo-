<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Click2Cash üçã </title>
    <!-- Firebase SDK, Tailwind CSS, Font Awesome, Google Fonts -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Noto Sans Bengali', sans-serif; }
        body { background: linear-gradient(135deg, #87CEEB, #98FB98); color: #1F2937; min-height: 100vh; overflow-x: hidden; position: relative; }
        .glass-card { background: rgba(255, 255, 255, 0.25); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); border-radius: 20px; border: 1px solid rgba(255, 255, 255, 0.3); box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1); }
        .btn-primary { background: linear-gradient(135deg, #00CED1, #20B2AA); color: white; border-radius: 16px; padding: 14px 24px; font-weight: bold; transition: all 0.3s ease; border: none; }
        .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; transform: none; box-shadow: none; }
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(10px); border-top: 1px solid rgba(255, 255, 255, 0.3); display: flex; justify-content: space-around; padding: 12px 0; z-index: 100; box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.1); }
        .nav-item { display: flex; flex-direction: column; align-items: center; font-size: 12px; color: #64748b; transition: all 0.3s ease; padding: 8px 12px; border-radius: 16px; cursor: pointer; }
        .nav-item.active { color: #00CED1; background: rgba(0, 206, 209, 0.1); }
        .nav-item i { font-size: 20px; margin-bottom: 4px; }
        .content-section { display: none; }
        .content-section.active { display: block; animation: fadeIn 0.5s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .wheel-container { position: relative; width: 320px; height: 320px; margin: 20px auto; display: flex; justify-content: center; align-items: center; }
        .wheel-pointer { position: absolute; top: -10px; left: 50%; transform: translateX(-50%); width: 40px; height: 50px; background: linear-gradient(160deg, #ff7675, #d63031); clip-path: polygon(50% 100%, 0 0, 100% 0); z-index: 20; filter: drop-shadow(0px 4px 5px rgba(0, 0, 0, 0.3)); }
        .wheel-outer-border { width: 100%; height: 100%; background: linear-gradient(135deg, #f8a5a5, #ff6b6b); border-radius: 50%; padding: 10px; box-shadow: 0 10px 25px rgba(0,0,0,0.2), inset 0 0 10px rgba(0,0,0,0.3); }
        .wheel-inner-border { width: 100%; height: 100%; background: #fff; border-radius: 50%; padding: 5px; position: relative; }
        .wheel { width: 100%; height: 100%; border-radius: 50%; position: relative; overflow: hidden; background: #bdc3c7; transition: transform 6s cubic-bezier(0.1, 0.7, 0.0, 1); }
        .wheel-section { position: absolute; width: 50%; height: 50%; transform-origin: bottom right; clip-path: polygon(0 0, 100% 0, 100% 100%); display: flex; align-items: center; justify-content: center; }
        .wheel-section span { display: block; color: white; font-weight: 700; font-size: 20px; text-shadow: 1px 1px 1px rgba(0,0,0,0.5); }
        .wheel-center { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 70px; height: 70px; background: radial-gradient(circle, #ffd700, #f0c000); border-radius: 50%; border: 5px solid #fff; box-shadow: 0 0 10px rgba(0,0,0,0.3); z-index: 15; }
        input, select { background: rgba(255, 255, 255, 0.7) !important; border-radius: 12px !important; border: 1px solid rgba(255, 255, 255, 0.3) !important; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 1000; justify-content: center; align-items: center; backdrop-filter: blur(5px); }
        .modal-content { background: rgba(255, 255, 255, 0.9); border-radius: 20px; padding: 24px; width: 90%; max-width: 400px; border: 1px solid rgba(255, 255, 255, 0.3); }
        .support-fab { position: fixed; bottom: 80px; right: 20px; width: 60px; height: 60px; background: linear-gradient(135deg, #007bff, #0056b3); border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25); z-index: 999; cursor: pointer; transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .support-fab.hidden { transform: translateX(80px); }
        .support-fab i { color: white; font-size: 28px; }
        .support-link-button { display: flex; align-items: center; width: 100%; padding: 16px; margin-bottom: 12px; border-radius: 12px; background-color: rgba(0,0,0,0.1); text-decoration: none; color: #1f2937; transition: background-color 0.3s; }
        .support-link-button:hover { background-color: rgba(0,0,0,0.2); }
        .support-link-button i { font-size: 24px; margin-right: 16px; width: 30px; text-align: center; }
    </style>
</head>
<body class="pb-24">
    <div id="auth-section" class="flex justify-center items-center min-h-screen p-5">
        <div class="glass-card w-full max-w-md p-8">
            <div id="login-form">
                <h2 class="text-2xl font-bold mb-6 text-center">‡¶≤‡¶ó ‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
                <form id="login-form-element">
                    <div class="mb-4"><label class="block mb-2">‡¶á‡¶Æ‡ßá‡¶á‡¶≤</label><input type="email" id="login-email" class="w-full p-3" required></div>
                    <div class="mb-4"><label class="block mb-2">‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°</label><input type="password" id="login-password" class="w-full p-3" required></div>
                    <div class="text-right mb-6"><a href="#" id="forgot-password-link" class="text-sm text-cyan-600 hover:underline">‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶≠‡ßÅ‡¶≤‡ßá ‡¶ó‡ßá‡¶õ‡ßá‡¶®?</a></div>
                    <button type="submit" class="btn-primary w-full py-3 mb-4">‡¶≤‡¶ó ‡¶á‡¶®</button>
                </form>
                <p class="text-center">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶®‡ßá‡¶á? <a href="#" id="show-register" class="text-cyan-600 hover:underline">‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®</a></p>
            </div>
            <div id="register-form" class="hidden">
                <h2 class="text-2xl font-bold mb-6 text-center">‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
                <form id="register-form-element">
                    <div class="mb-4"><label class="block mb-2">‡¶™‡ßÅ‡¶∞‡ßã ‡¶®‡¶æ‡¶Æ</label><input type="text" id="register-name" class="w-full p-3" required></div>
                    <div class="mb-4"><label class="block mb-2">‡¶á‡¶Æ‡ßá‡¶á‡¶≤</label><input type="email" id="register-email" class="w-full p-3" required></div>
                    <div class="mb-6"><label class="block mb-2">‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°</label><input type="password" id="register-password" class="w-full p-3" required></div>
                    <button type="submit" class="btn-primary w-full py-3 mb-4">‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞</button>
                </form>
                <p class="text-center">‡¶á‡¶§‡¶ø‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶Ü‡¶õ‡ßá? <a href="#" id="show-login" class="text-cyan-600 hover:underline">‡¶≤‡¶ó ‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</a></p>
            </div>
        </div>
    </div>

    <div id="main-app" class="hidden">
        <header class="p-4 flex justify-between items-center glass-card m-2 rounded-2xl">
            <div><h1 class="text-2xl font-bold">Click2Cash</h1><p class="text-gray-600">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ü‡¶Ø‡¶º‡ßá‡¶∞ ‡¶™‡¶•</p></div>
            <div class="text-right"><p id="user-name" class="font-semibold"></p><p class="text-sm">‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏: ‡ß≥<span id="header-balance">0.00</span></p></div>
        </header>
        <main class="p-4 max-w-lg mx-auto">
            <section id="home" class="content-section active">
                <div class="glass-card p-6 mb-6 text-center"><h2 class="text-lg">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏</h2><p class="text-5xl font-bold">‡ß≥<span id="wallet-balance">0.00</span></p><div class="mt-4 flex justify-around text-sm"><div><p>‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶Ü‡¶Ø‡¶º</p><p class="font-bold">‡ß≥<span id="today-earnings">0.00</span></p></div><div><p>‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤</p><p class="font-bold"><span id="referral-count">0</span> ‡¶ú‡¶®</p></div></div><button id="withdraw-btn-home" class="btn-primary mt-6 w-full"><i class="fas fa-money-bill-wave mr-2"></i> ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶§‡ßÅ‡¶≤‡ßÅ‡¶®</button></div>
                <div class="grid grid-cols-2 gap-4 mb-6"><button id="watch-ad-btn" class="glass-card p-4 flex flex-col items-center justify-center"><i class="fas fa-video text-3xl mb-2 text-cyan-500"></i><span class="font-semibold">‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</span><span id="watch-ad-notice" class="text-xs mt-1"></span></button><button data-target="tasks" class="nav-btn glass-card p-4 flex flex-col items-center justify-center"><i class="fas fa-tasks text-3xl mb-2 text-cyan-500"></i><span class="font-semibold">‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®</span><span id="do-task-notice" class="text-xs mt-1"></span></button><button data-target="spin" class="nav-btn glass-card p-4 flex flex-col items-center justify-center"><i class="fas fa-dharmachakra text-3xl mb-2 text-cyan-500"></i><span class="font-semibold">‡¶∏‡ßç‡¶™‡¶ø‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</span><span id="spin-wheel-notice" class="text-xs mt-1"></span></button><button data-target="profile" class="nav-btn glass-card p-4 flex flex-col items-center justify-center"><i class="fas fa-user-plus text-3xl mb-2 text-cyan-500"></i><span class="font-semibold">‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®</span><span id="referral-notice" class="text-xs mt-1"></span></button></div>
                <div class="glass-card p-6"><h3 class="text-xl font-bold mb-4 flex items-center"><i class="fas fa-history mr-3 text-cyan-500"></i>‡¶∏‡¶æ‡¶Æ‡ßç‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ï ‡¶ï‡¶æ‡¶∞‡ßç‡¶Ø‡¶ï‡ßç‡¶∞‡¶Æ</h3><div id="recent-activity" class="space-y-3"></div></div>
            </section>
            <section id="tasks" class="content-section"><div class="glass-card p-6"><h2 class="text-2xl font-bold mb-4"><i class="fas fa-tasks mr-3 text-cyan-500"></i>‡¶°‡ßá‡¶á‡¶≤‡¶ø ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï</h2><div id="tasks-list" class="space-y-4"></div></div></section>
            <section id="spin" class="content-section"><div class="glass-card p-6 text-center"><h2 class="text-2xl font-bold mb-2">‡¶∏‡ßç‡¶™‡¶ø‡¶® ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶Ø‡¶º ‡¶ï‡¶∞‡ßÅ‡¶®</h2><p class="mb-6">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶∏‡ßç‡¶™‡¶ø‡¶®: <span id="spins-left">3</span>/<span id="daily-spin-limit-text">3</span></p><div class="wheel-container"><div class="wheel-outer-border"><div class="wheel-inner-border"><div class="wheel" id="wheel"></div></div></div><div class="wheel-center"></div><div class="wheel-pointer"></div></div><button id="spin-wheel-btn" class="btn-primary w-full py-3 text-lg mt-4">‡¶∏‡ßç‡¶™‡¶ø‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</button></div></section>
            <section id="wallet" class="content-section">
                <div class="glass-card p-6">
                    <h2 class="text-2xl font-bold mb-6"><i class="fas fa-wallet mr-3 text-cyan-500"></i>‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶ì‡¶Ø‡¶º‡¶æ‡¶≤‡ßá‡¶ü</h2>
                    <div id="wallet-notice" class="mb-4 p-4 bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 rounded-lg"></div>
                    
                    <!-- ### ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡ßß: "‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®‡ßá‡¶∞ ‡¶∂‡¶∞‡ßç‡¶§‡¶æ‡¶¨‡¶≤‡ßÄ" ‡¶∏‡ßá‡¶ï‡¶∂‡¶®‡¶ü‡¶ø ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶∏‡ßç‡¶•‡¶æ‡¶®‡¶æ‡¶®‡ßç‡¶§‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá ### -->
                    <div class="mb-6">
                        <h3 class="text-xl font-bold mb-4">‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®‡ßá‡¶∞ ‡¶∂‡¶∞‡ßç‡¶§‡¶æ‡¶¨‡¶≤‡ßÄ</h3>
                        <div id="withdrawal-conditions" class="space-y-2 p-4 bg-white/50 rounded-lg">
                            <!-- ‡¶∂‡¶∞‡ßç‡¶§‡¶ó‡ßÅ‡¶≤‡ßã ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶ú‡¶æ‡¶≠‡¶æ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡ßç‡¶ü ‡¶•‡ßá‡¶ï‡ßá ‡¶Ü‡¶∏‡¶¨‡ßá -->
                        </div>
                    </div>

                    <div class="mb-6 p-4 bg-cyan-100 rounded-xl text-gray-800">
                        <p>‡¶Æ‡ßã‡¶ü ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏</p>
                        <p class="text-4xl font-bold my-2">‡ß≥<span id="wallet-total">0.00</span></p>
                        <p class="text-sm">‡¶®‡ßç‡¶Ø‡ßÇ‡¶®‡¶§‡¶Æ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®: ‡ß≥<span id="min-withdrawal-text">50.00</span></p>
                    </div>
                    <div class="space-y-4 mb-6">
                        <div class="flex justify-between items-center p-3 bg-white/70 rounded-lg">
                            <div><p class="font-semibold">‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶Ü‡¶Ø‡¶º</p></div>
                            <p class="text-xl font-bold text-green-500">‡ß≥<span id="wallet-today">0.00</span></p>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-white/70 rounded-lg">
                            <div><p class="font-semibold">‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶Ü‡¶Ø‡¶º</p></div>
                            <p class="text-xl font-bold text-cyan-500">‡ß≥<span id="wallet-referral">0.00</span></p>
                        </div>
                    </div>
                    <button id="wallet-withdraw-btn" class="btn-primary w-full py-3"><i class="fas fa-money-bill-wave mr-2"></i> ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</button>

                    <div class="mt-8">
                        <h3 class="text-xl font-bold mb-4">‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®‡ßá‡¶∞ ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡¶ø</h3>
                        <div id="withdrawal-history" class="space-y-3">
                            <!-- ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡¶ø ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶ú‡¶æ‡¶≠‡¶æ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡ßç‡¶ü ‡¶•‡ßá‡¶ï‡ßá ‡¶Ü‡¶∏‡¶¨‡ßá -->
                        </div>
                    </div>
                </div>
            </section>
            <section id="profile" class="content-section"><div class="glass-card p-6"><h2 class="text-2xl font-bold mb-6"><i class="fas fa-user mr-3 text-cyan-500"></i>‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤</h2><div class="flex items-center mb-6"><div class="w-16 h-16 rounded-full bg-cyan-400 flex items-center justify-center text-white text-2xl font-bold mr-4"><i class="fas fa-user"></i></div><div><p id="profile-name" class="font-bold text-xl"></p><p>‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø since <span id="join-date"></span></p></div></div><div class="space-y-4 mb-6"><div class="p-4 bg-white/70 rounded-lg"><p class="mb-1">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï</p><div class="flex"><input type="text" id="referral-link" class="flex-grow p-2 bg-gray-100 rounded-l-lg" readonly><button id="copy-link" class="bg-cyan-500 text-white px-4 rounded-r-lg"><i class="fas fa-copy"></i></button></div></div><div class="grid grid-cols-2 gap-4"><div class="p-3 bg-white/70 rounded-lg text-center"><p class="text-2xl font-bold text-cyan-500" id="profile-tasks">0</p><p>‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï</p></div><div class="p-3 bg-white/70 rounded-lg text-center"><p class="text-2xl font-bold text-green-500" id="profile-referrals">0</p><p>‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤</p></div></div></div><button id="logout-btn" class="w-full py-3 bg-red-500 hover:bg-red-600 text-white rounded-lg font-bold">‡¶≤‡¶ó ‡¶Ü‡¶â‡¶ü</button></div></section>
        </main>
        <nav class="bottom-nav"><a class="nav-item active" data-section="home"><i class="fas fa-home"></i><span>‡¶π‡ßã‡¶Æ</span></a><a class="nav-item" data-section="tasks"><i class="fas fa-tasks"></i><span>‡¶ü‡¶æ‡¶∏‡ßç‡¶ï</span></a><a class="nav-item" data-section="spin"><i class="fas fa-dharmachakra"></i><span>‡¶∏‡ßç‡¶™‡¶ø‡¶®</span></a><a class="nav-item" data-section="wallet"><i class="fas fa-wallet"></i><span>‡¶ì‡¶Ø‡¶º‡¶æ‡¶≤‡ßá‡¶ü</span></a><a class="nav-item" data-section="profile"><i class="fas fa-user"></i><span>‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤</span></a></nav>
        
        <div id="support-fab" class="support-fab" style="display: none;"><i class="fas fa-headset"></i></div>

        <div id="withdraw-modal" class="modal">
            <div class="modal-content">
                <h2 class="text-xl font-bold mb-4 text-center">‡¶ü‡¶æ‡¶ï‡¶æ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
                <form id="withdraw-form">
                    <div class="mb-4"><label class="block mb-2">‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶Æ‡ßá‡¶•‡¶°</label><select id="withdraw-method" class="w-full p-3"><option>bKash</option><option>Nagad</option><option>Rocket</option></select></div>
                    <div class="mb-4"><label class="block mb-2">‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞</label><input type="text" id="withdraw-number" class="w-full p-3" required></div>
                    <div class="mb-4"><label class="block mb-2">‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ (‡ß≥)</label><input type="number" step="0.01" id="withdraw-amount" class="w-full p-3" placeholder="‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®" required></div>
                    <div class="flex justify-between mt-6"><button type="button" id="cancel-withdraw" class="px-4 py-2 bg-gray-500 text-gray-800 rounded-lg">‡¶¨‡¶æ‡¶§‡¶ø‡¶≤</button><button type="submit" class="px-4 py-2 bg-green-500 text-white rounded-lg">‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶®</button></div>
                </form>
            </div>
        </div>
        
        <div id="support-modal" class="modal">
            <div class="modal-content">
                <h2 class="text-xl font-bold mb-6 text-center">‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü</h2>
                <div id="support-links-container"></div>
                <button id="close-support-modal" class="w-full mt-4 py-2 bg-gray-600 text-white rounded-lg">‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            </div>
        </div>
    </div>

    <script>
        const firebaseConfig = { apiKey: "AIzaSyBowdaBVkAZa7OLr0wmJxjn9JqSlsy7l5o", authDomain: "pomelo-50690.firebaseapp.com", projectId: "pomelo-50690", storageBucket: "pomelo-50690.firebasestorage.app", messagingSenderId: "687340787607", appId: "1:687340787607:web:5c2fe2d6d0ff09c6c956d2" };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        let currentUser = null, userData = null, userListener = null, adSettings = [], spinAdSettings = [], taskAdSettings = [], appSettings = {};
        let spinPrizes = [];

        const showAuthSection = () => { document.getElementById('auth-section').style.display = 'flex'; document.getElementById('main-app').classList.add('hidden'); };
        const showMainApp = () => { document.getElementById('auth-section').style.display = 'none'; document.getElementById('main-app').classList.remove('hidden'); };
        const switchToRegister = () => { document.getElementById('login-form').classList.add('hidden'); document.getElementById('register-form').classList.remove('hidden'); };
        const switchToLogin = () => { document.getElementById('register-form').classList.add('hidden'); document.getElementById('login-form').classList.remove('hidden'); };

        async function loadAppSettings() {
            const doc = await db.collection('app_settings').doc('config').get();
            const defaults = {
                minWithdrawal: 50, referralBonus: 5, dailySpins: 3, watchAdReward: 5, spinPrizes: [3, 2, 5, 8, 10, 15, 20, 1], watchAdNotice: '‡ß≥5.00 ‡¶Ü‡¶Ø‡¶º ‡¶ï‡¶∞‡ßÅ‡¶®', doTaskNotice: '‡¶Ü‡¶Ø‡¶º ‡¶ï‡¶∞‡ßÅ‡¶®', spinWheelNotice: '‡¶™‡ßÅ‡¶∞‡¶∏‡ßç‡¶ï‡¶æ‡¶∞ ‡¶ú‡¶ø‡¶§‡ßÅ‡¶®', referralNotice: '‡ß≥5.00 ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶™‡¶æ‡¶®', supportLinks: [], minReferrals: 10, minBalance: 1000, walletNotice: '‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü‡ßá ‡¶®‡ßç‡¶Ø‡ßÇ‡¶®‡¶§‡¶Æ ‡ßß‡ß¶‡¶ü‡¶ø ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶è‡¶¨‡¶Ç ‡ß≥‡ßß‡ß¶‡ß¶‡ß¶ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶•‡¶æ‡¶ï‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§'
            };
            appSettings = doc.exists ? { ...defaults, ...doc.data() } : defaults;
            spinPrizes = appSettings.spinPrizes;
            generateWheelSections();
            const supportBtn = document.getElementById('support-fab');
            if (appSettings.supportLinks && appSettings.supportLinks.length > 0) {
                populateSupportModal();
                supportBtn.style.display = 'flex';
            } else {
                supportBtn.style.display = 'none';
            }
        }
        function populateSupportModal() { const container = document.getElementById('support-links-container'); container.innerHTML = ''; appSettings.supportLinks.forEach(link => { if(link.url) { container.innerHTML += `<a href="${link.url}" target="_blank" class="support-link-button"><i class="${link.icon || 'fas fa-question-circle'}"></i><span>${link.name || 'Support'}</span></a>`; } }); }
        function generateWheelSections() { const wheel = document.getElementById('wheel'); if (!wheel) return; wheel.innerHTML = ''; const colors = ['#3498db', '#e67e22', '#2ecc71', '#9b59b6', '#f1c40f', '#e74c3c', '#1abc9c', '#34495e']; const angle = 360 / (spinPrizes.length || 8); spinPrizes.forEach((prize, index) => { const section = document.createElement('div'); section.className = 'wheel-section'; section.style.background = colors[index % colors.length]; section.style.transform = `rotate(${index * angle}deg)`; section.innerHTML = `<span style="transform: rotate(${angle / 2}deg) translateY(-100%)">${'‡ß≥' + prize}</span>`; wheel.appendChild(section); }); }
        
        async function initializeUserData(user) { const userRef = db.collection('users').doc(user.uid); const userDoc = await userRef.get(); if (userDoc.exists) return userDoc.data(); const ref = new URLSearchParams(window.location.search).get('ref'); const newUserData = { uid: user.uid, email: user.email, name: user.displayName || '‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ', balance: 0, todayEarnings: 0, totalEarnings: 0, referralEarnings: 0, adsCompleted: 0, tasksCompleted: [], spinsUsed: 0, lastSpinDate: null, referrals: 0, joinDate: new Date().toISOString(), referredBy: ref || null, isBanned: false }; await userRef.set(newUserData); if (ref) { const referrerRef = db.collection('users').doc(ref); const referralBonus = appSettings.referralBonus || 5; await db.runTransaction(async (t) => { const doc = await t.get(referrerRef); if (doc.exists) { t.update(referrerRef, { balance: firebase.firestore.FieldValue.increment(referralBonus), referralEarnings: firebase.firestore.FieldValue.increment(referralBonus), referrals: firebase.firestore.FieldValue.increment(1) }); } }); await addNotification('‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶¨‡ßã‡¶®‡¶æ‡¶∏!', `‡¶Ü‡¶™‡¶®‡¶ø ‡¶è‡¶ï‡¶ú‡¶® ‡¶®‡¶§‡ßÅ‡¶® ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶™‡ßá‡ßü‡ßá‡¶õ‡ßá‡¶®‡•§`, ref); } return newUserData; }
        
        const listenToUserData = (uid) => { if (userListener) userListener(); userListener = db.collection('users').doc(uid).onSnapshot((doc) => { if (doc.exists) { userData = doc.data(); updateAllUI(); } }); };
        
        // ### ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡ß®: "‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®‡ßá‡¶∞ ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡¶ø" ‡¶≤‡ßã‡¶°‡¶ø‡¶Ç ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ‡¶∏‡¶Ç‡¶∂‡ßã‡¶ß‡¶® ###
        async function loadWithdrawalHistory() {
            const historyContainer = document.getElementById('withdrawal-history');
            if (!currentUser) { // ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ ‡¶≤‡¶ó‡¶á‡¶® ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ‡¶ö‡¶≤‡¶¨‡ßá ‡¶®‡¶æ
                historyContainer.innerHTML = '<p class="text-center">‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡¶ø ‡¶¶‡ßá‡¶ñ‡¶§‡ßá ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p>';
                return;
            }
            historyContainer.innerHTML = '<p>‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡¶ø ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>';
            try {
                const snapshot = await db.collection('withdrawals').where('userId', '==', currentUser.uid).orderBy('timestamp', 'desc').limit(10).get();
                if (snapshot.empty) {
                    historyContainer.innerHTML = '<p class="text-center">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ï‡ßã‡¶®‡ßã ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®‡ßá‡¶∞ ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶° ‡¶®‡ßá‡¶á‡•§</p>';
                    return;
                }
                historyContainer.innerHTML = '';
                snapshot.forEach(doc => {
                    const withdrawal = doc.data();
                    let statusClass = '', statusText = '';
                    switch (withdrawal.status) {
                        case 'approved': statusClass = 'text-green-600 bg-green-100'; statusText = '‡¶Ö‡¶®‡ßÅ‡¶Æ‡ßã‡¶¶‡¶ø‡¶§'; break;
                        case 'rejected': statusClass = 'text-red-600 bg-red-100'; statusText = '‡¶™‡ßç‡¶∞‡¶§‡ßç‡¶Ø‡¶æ‡¶ñ‡ßç‡¶Ø‡¶æ‡¶§'; break;
                        default: statusClass = 'text-yellow-600 bg-yellow-100'; statusText = '‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç';
                    }
                    historyContainer.innerHTML += `
                        <div class="p-3 bg-white/70 rounded-lg flex justify-between items-center">
                            <div>
                                <p class="font-bold">‡ß≥${withdrawal.amount.toFixed(2)} - ${withdrawal.method}</p>
                                <p class="text-sm text-gray-600">${new Date(withdrawal.timestamp).toLocaleDateString('bn-BD')}</p>
                            </div>
                            <span class="px-3 py-1 text-sm font-semibold rounded-full ${statusClass}">${statusText}</span>
                        </div>`;
                });
            } catch (error) {
                console.error("Error loading withdrawal history:", error);
                historyContainer.innerHTML = '<p class="text-center text-red-500">‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡¶ø ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§</p>';
            }
        }
        
        async function addActivity(title, amount) { if (amount > 0) { await db.collection('activities').add({ userId: currentUser.uid, title, amount, timestamp: new Date().toISOString() }); } }
        async function addNotification(title, message, forUserId = null) { await db.collection('notifications').add({ userId: forUserId || currentUser.uid, title, message, timestamp: new Date().toISOString(), read: false }); }

        function updateAllUI() {
            if (!userData || !appSettings) return;
            ['wallet-balance', 'header-balance', 'wallet-total'].forEach(id => document.getElementById(id).textContent = (userData.balance || 0).toFixed(2));
            ['today-earnings', 'wallet-today'].forEach(id => document.getElementById(id).textContent = (userData.todayEarnings || 0).toFixed(2));
            document.getElementById('referral-count').textContent = userData.referrals || 0;
            document.getElementById('wallet-referral').textContent = (userData.referralEarnings || 0).toFixed(2);
            document.getElementById('user-name').textContent = userData.name;
            document.getElementById('profile-name').textContent = userData.name;
            document.getElementById('join-date').textContent = new Date(userData.joinDate).toLocaleDateString('bn-BD');
            document.getElementById('referral-link').value = `${window.location.origin}${window.location.pathname}?ref=${currentUser.uid}`;
            document.getElementById('profile-tasks').textContent = (userData.tasksCompleted || []).filter(key => key.endsWith(new Date().toDateString())).length;
            document.getElementById('profile-referrals').textContent = userData.referrals || 0;
            document.getElementById('min-withdrawal-text').textContent = (appSettings.minWithdrawal || 50).toFixed(2);
            document.getElementById('watch-ad-notice').textContent = appSettings.watchAdNotice || '';
            document.getElementById('do-task-notice').textContent = appSettings.doTaskNotice || '';
            document.getElementById('spin-wheel-notice').textContent = appSettings.spinWheelNotice || '';
            document.getElementById('referral-notice').textContent = appSettings.referralNotice || (appSettings.referralBonus ? `‡ß≥${appSettings.referralBonus.toFixed(2)} ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶™‡¶æ‡¶®` : '');
            document.getElementById('daily-spin-limit-text').textContent = appSettings.dailySpins || 3;
            document.getElementById('wallet-notice').textContent = appSettings.walletNotice || '';
            
            const conditionsContainer = document.getElementById('withdrawal-conditions');
            const userReferrals = userData.referrals || 0;
            const userBalance = userData.balance || 0;
            const minReferrals = appSettings.minReferrals || 0;
            const minBalance = appSettings.minBalance || 0;
            const referralsMet = userReferrals >= minReferrals;
            const balanceMet = userBalance >= minBalance;
            conditionsContainer.innerHTML = `
                <p class="flex justify-between">
                    <span>‡¶®‡ßç‡¶Ø‡ßÇ‡¶®‡¶§‡¶Æ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤:</span>
                    <span class="${referralsMet ? 'text-green-600' : 'text-red-600'} font-bold">${userReferrals} / ${minReferrals} ${referralsMet ? '<i class="fas fa-check-circle"></i>' : '<i class="fas fa-times-circle"></i>'}</span>
                </p>
                <p class="flex justify-between">
                    <span>‡¶®‡ßç‡¶Ø‡ßÇ‡¶®‡¶§‡¶Æ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏:</span>
                    <span class="${balanceMet ? 'text-green-600' : 'text-red-600'} font-bold">‡ß≥${userBalance.toFixed(2)} / ‡ß≥${minBalance.toFixed(2)} ${balanceMet ? '<i class="fas fa-check-circle"></i>' : '<i class="fas fa-times-circle"></i>'}</span>
                </p>`;
            
            const today = new Date().toDateString();
            if (userData.lastSpinDate !== today) {
                db.collection('users').doc(currentUser.uid).update({ spinsUsed: 0, lastSpinDate: today });
            }
            const spinsUsed = userData.spinsUsed || 0;
            document.getElementById('spins-left').textContent = (appSettings.dailySpins || 3) - spinsUsed;
            document.getElementById('spin-wheel-btn').disabled = spinsUsed >= (appSettings.dailySpins || 3);
            
            ['withdraw-btn-home', 'wallet-withdraw-btn'].forEach(id => document.getElementById(id).disabled = false);
            
            updateTasksList();
            updateRecentActivities();
            loadWithdrawalHistory();
        }
        
        const getTasksToClaim = () => JSON.parse(sessionStorage.getItem('tasksToClaim')) || [];
        const addTaskToClaim = (taskId) => { const tasks = getTasksToClaim(); if (!tasks.includes(taskId)) { tasks.push(taskId); sessionStorage.setItem('tasksToClaim', JSON.stringify(tasks)); } };
        const removeTaskFromClaim = (taskId) => { let tasks = getTasksToClaim(); tasks = tasks.filter(id => id !== taskId); sessionStorage.setItem('tasksToClaim', JSON.stringify(tasks)); };

        async function updateTasksList() { const list = document.getElementById('tasks-list'); list.innerHTML = '<p>‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>'; const snapshot = await db.collection('tasks').where('status', '==', 'active').get(); if (snapshot.empty) { list.innerHTML = '<p>‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ï‡ßã‡¶®‡ßã ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶®‡ßá‡¶á‡•§</p>'; return; } const tasksToClaim = getTasksToClaim(); list.innerHTML = ''; snapshot.forEach(doc => { const task = doc.data(); const taskId = doc.id; const taskKey = `${taskId}_${new Date().toDateString()}`; const isCompleted = (userData.tasksCompleted || []).includes(taskKey); const isReadyToClaim = tasksToClaim.includes(taskId); let buttonHTML = ''; if (isCompleted) { buttonHTML = `<button class="w-28 text-white px-4 py-2 rounded-lg text-sm font-bold bg-gray-400" disabled>‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶®</button>`; } else if (isReadyToClaim) { buttonHTML = `<button class="claim-task-btn w-28 text-white px-4 py-2 rounded-lg text-sm font-bold bg-green-500 hover:bg-green-600" data-id="${taskId}" data-reward="${task.reward}">‡¶™‡ßÅ‡¶∞‡¶∏‡ßç‡¶ï‡¶æ‡¶∞ ‡¶®‡¶ø‡¶®</button>`; } else { buttonHTML = `<button class="do-task-btn w-28 text-white px-4 py-2 rounded-lg text-sm font-bold bg-cyan-500 hover:bg-cyan-600" data-id="${taskId}" data-link="${task.link}">‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®</button>`; } const imageOrIconHTML = task.imageUrl ? `<img src="${task.imageUrl}" class="w-12 h-12 rounded-lg object-cover mr-4 flex-shrink-0">` : `<i class="${task.icon || 'fas fa-tasks'} text-cyan-500 text-3xl mr-4 w-12 text-center flex-shrink-0"></i>`; list.innerHTML += `<div class="flex items-center justify-between p-4 bg-white/30 rounded-lg"><div class="flex items-center flex-grow">${imageOrIconHTML}<div><p class="font-semibold">${task.name}</p><p class="text-sm text-yellow-800 font-bold">‡¶™‡ßÅ‡¶∞‡¶∏‡ßç‡¶ï‡¶æ‡¶∞: ‡ß≥${task.reward.toFixed(2)}</p></div></div><div class="flex-shrink-0 ml-2">${buttonHTML}</div></div>`; }); }
        
        // ### ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡ß©: "‡¶∏‡¶æ‡¶Æ‡ßç‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ï ‡¶ï‡¶æ‡¶∞‡ßç‡¶Ø‡¶ï‡ßç‡¶∞‡¶Æ" ‡¶≤‡ßã‡¶°‡¶ø‡¶Ç ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ‡¶∏‡¶Ç‡¶∂‡ßã‡¶ß‡¶® ###
        async function updateRecentActivities() {
            const container = document.getElementById('recent-activity');
            if (!currentUser) { // ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ ‡¶≤‡¶ó‡¶á‡¶® ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ‡¶ö‡¶≤‡¶¨‡ßá ‡¶®‡¶æ
                container.innerHTML = '<p class="text-center">‡¶ï‡¶æ‡¶∞‡ßç‡¶Ø‡¶ï‡ßç‡¶∞‡¶Æ ‡¶¶‡ßá‡¶ñ‡¶§‡ßá ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p>';
                return;
            }
            container.innerHTML = '<p>‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>';
            try {
                const snapshot = await db.collection('activities').where('userId', '==', currentUser.uid).orderBy('timestamp', 'desc').limit(5).get();
                if(snapshot.empty) {
                    container.innerHTML = '<p class="text-center">‡¶ï‡ßã‡¶®‡ßã ‡¶∏‡¶æ‡¶Æ‡ßç‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ï ‡¶ï‡¶æ‡¶∞‡ßç‡¶Ø‡¶ï‡ßç‡¶∞‡¶Æ ‡¶®‡ßá‡¶á‡•§</p>';
                    return;
                }
                container.innerHTML = '';
                snapshot.forEach(doc => {
                    const act = doc.data();
                    container.innerHTML += `<div class="flex justify-between items-center p-3 bg-white/70 rounded-lg"><div><p class="font-semibold">${act.title}</p><p class="text-sm">${new Date(act.timestamp).toLocaleString('bn-BD')}</p></div><p class="text-green-500 font-bold">+‡ß≥${act.amount.toFixed(2)}</p></div>`;
                });
            } catch (error) {
                console.error("Error loading recent activities:", error);
                container.innerHTML = '<p class="text-center text-red-500">‡¶ï‡¶æ‡¶∞‡ßç‡¶Ø‡¶ï‡ßç‡¶∞‡¶Æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§</p>';
            }
        }
        
        async function initializeAdNetworks(collectionName) { const ref = db.collection(collectionName); const snap = await ref.limit(1).get(); if (snap.empty) { const batch = db.batch(); batch.set(ref.doc('monetag'), { name: 'Monetag', isActive: false, zones: [{ id: 'YOUR_ID', reward: 0, isActive: false }] }); batch.set(ref.doc('gigapub'), { name: 'Gigapub', isActive: false, zones: [{ id: 'YOUR_ID', reward: 0, isActive: false }] }); batch.set(ref.doc('adexora'), { name: 'Adexora', isActive: false, zones: [{ id: 'YOUR_ID', reward: 0, isActive: false }] }); await batch.commit(); } }
        async function loadAdScriptsAndSettings(collectionName) { const networksSnapshot = await db.collection(collectionName).get(); const groupedAds = {}; networksSnapshot.forEach(doc => { const network = doc.data(); if (network.isActive && network.zones) { groupedAds[doc.id] = []; network.zones.forEach(zone => { if (zone.isActive && zone.id && zone.id.toUpperCase() !== 'YOUR_ID' && zone.id.toUpperCase() !== 'NEW_ZONE_ID') { const adData = { type: doc.id, zoneId: zone.id }; groupedAds[doc.id].push(adData); const scriptId = `ad-sdk-${doc.id}-${zone.id}`; if (!document.getElementById(scriptId)) { const script = document.createElement('script'); script.id = scriptId; if (doc.id === 'monetag') { script.src = `//libtl.com/sdk.js`; script.setAttribute('data-zone', zone.id); script.setAttribute('data-sdk', `show_${zone.id}`); } else if (doc.id === 'gigapub') { script.src = `https://ad.gigapub.tech/script?id=${zone.id}`; } else if (doc.id === 'adexora') { script.src = `https://adexora.com/cdn/ads.js?id=${zone.id}`; } document.head.appendChild(script); } } }); } }); const finalAdQueue = []; const monetagAds = groupedAds['monetag'] ? [...groupedAds['monetag']] : []; const otherNetworkNames = Object.keys(groupedAds).filter(name => name !== 'monetag'); const otherAdsGrouped = {}; otherNetworkNames.forEach(name => { otherAdsGrouped[name] = groupedAds[name]; }); if (monetagAds.length > 0) { finalAdQueue.push(monetagAds.shift()); } const interleavedRest = []; const maxLength = Math.max(0, ...Object.values(otherAdsGrouped).map(arr => arr.length), monetagAds.length); for (let i = 0; i < maxLength; i++) { if(monetagAds[i]) interleavedRest.push(monetagAds[i]); for (const name of otherNetworkNames) { if (otherAdsGrouped[name][i]) { interleavedRest.push(otherAdsGrouped[name][i]); } } } finalAdQueue.push(...interleavedRest); return { ads: finalAdQueue }; }
        async function showMandatoryAdAfterAction(adQueue) { return new Promise(async (resolve, reject) => { if (!adQueue || adQueue.length === 0) { return resolve(); } const waitForSdk = (ad, timeout = 7000) => new Promise((resolveSdk, rejectSdk) => { const getRunner = () => { if (ad.type === 'monetag') return window[`show_${ad.zoneId}`]; if (ad.type === 'adexora') return window.showAdexora; if (ad.type === 'gigapub') return window.showGiga; return null; }; if (typeof getRunner() === 'function') return resolveSdk(getRunner()); const start = Date.now(); const interval = setInterval(() => { const runnerNow = getRunner(); if (typeof runnerNow === 'function') { clearInterval(interval); resolveSdk(runnerNow); } else if (Date.now() - start > timeout) { clearInterval(interval); rejectSdk(new Error(`${ad.type} SDK ‡¶≤‡ßã‡¶° ‡¶π‡¶§‡ßá ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•‡•§`)); } }, 500); }); try { for (const ad of adQueue) { const adRunner = await waitForSdk(ad); const result = adRunner(); if (result && typeof result.then === 'function') { await result; } } resolve(); } catch (error) { console.error('Ad error:', error); reject(error); } }); }

        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('show-register').addEventListener('click', (e) => { e.preventDefault(); switchToRegister(); });
            document.getElementById('show-login').addEventListener('click', (e) => { e.preventDefault(); switchToLogin(); });
            document.getElementById('forgot-password-link').addEventListener('click', async (e) => {
                e.preventDefault();
                const email = prompt("‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞‡ßç‡¶° ‡¶á‡¶Æ‡ßá‡¶á‡¶≤‡¶ü‡¶ø ‡¶¶‡¶ø‡¶®:", "");
                if (email) {
                    try {
                        await auth.sendPasswordResetEmail(email);
                        alert("‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶è‡¶ï‡¶ü‡¶ø ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶á‡¶Æ‡ßá‡¶á‡¶≤‡ßá ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§\n\n‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶á‡¶Æ‡ßá‡¶á‡¶≤‡ßá‡¶∞ ‡¶á‡¶®‡¶¨‡¶ï‡ßç‡¶∏ ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®‡•§ ‡¶Ø‡¶¶‡¶ø ‡¶á‡¶®‡¶¨‡¶ï‡ßç‡¶∏‡ßá ‡¶á‡¶Æ‡ßá‡¶á‡¶≤‡¶ü‡¶ø ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßá ‡¶®‡¶æ ‡¶™‡¶æ‡¶®, ‡¶§‡¶¨‡ßá ‡¶∏‡ßç‡¶™‡ßç‡¶Ø‡¶æ‡¶Æ (Spam) ‡¶¨‡¶æ ‡¶ú‡¶æ‡¶ô‡ßç‡¶ï (Junk) ‡¶´‡ßã‡¶≤‡ßç‡¶°‡¶æ‡¶∞ ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶§‡ßá ‡¶≠‡ßÅ‡¶≤‡¶¨‡ßá‡¶® ‡¶®‡¶æ‡•§");
                    } catch (error) {
                        alert("‡¶è‡¶ï‡¶ü‡¶ø ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶∏‡¶†‡¶ø‡¶ï ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶¶‡¶ø‡¶®‡•§");
                        console.error("Password Reset Error:", error);
                    }
                }
            });
            document.getElementById('login-form-element').addEventListener('submit', async (e) => { e.preventDefault(); try { await auth.signInWithEmailAndPassword(document.getElementById('login-email').value, document.getElementById('login-password').value); } catch (err) { alert('‡¶≤‡¶ó ‡¶á‡¶® ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•: ' + err.message); }});
            document.getElementById('register-form-element').addEventListener('submit', async (e) => { e.preventDefault(); try { const cred = await auth.createUserWithEmailAndPassword(document.getElementById('register-email').value, document.getElementById('register-password').value); await cred.user.updateProfile({ displayName: document.getElementById('register-name').value }); } catch (err) { alert('‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶® ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•: ' + err.message); }});
            
            const sections = document.querySelectorAll('.content-section'), navItems = document.querySelectorAll('.nav-item'), navButtons = document.querySelectorAll('.nav-btn');
            function navigateTo(sectionId) { sections.forEach(s => s.classList.remove('active')); document.getElementById(sectionId)?.classList.add('active'); navItems.forEach(n => n.classList.toggle('active', n.dataset.section === sectionId)); }
            navItems.forEach(item => item.addEventListener('click', (e) => { e.preventDefault(); navigateTo(item.dataset.section); }));
            navButtons.forEach(button => button.addEventListener('click', (e) => { e.preventDefault(); navigateTo(button.dataset.target); }));
            
            document.getElementById('watch-ad-btn').addEventListener('click', async function() { this.disabled = true; try { await showMandatoryAdAfterAction(adSettings); const rewardAmount = appSettings.watchAdReward || 0; if (rewardAmount > 0) { const inc = firebase.firestore.FieldValue.increment; await db.collection('users').doc(currentUser.uid).update({ balance: inc(rewardAmount), todayEarnings: inc(rewardAmount), totalEarnings: inc(rewardAmount), adsCompleted: inc(1) }); await addActivity('‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡¶æ', rewardAmount); alert(`‡¶ß‡¶®‡ßç‡¶Ø‡¶¨‡¶æ‡¶¶! ‡ß≥${rewardAmount.toFixed(2)} ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§`); } } catch (e) { alert('‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡¶æ‡¶§‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§'); } finally { this.disabled = false; } });
            
            document.getElementById('tasks-list').addEventListener('click', async (e) => { const btn = e.target.closest('button'); if (!btn) return; const taskId = btn.dataset.id; const taskKey = `${taskId}_${new Date().toDateString()}`; if (btn.classList.contains('do-task-btn')) { const link = btn.dataset.link; if (link) window.open(link, '_blank'); addTaskToClaim(taskId); updateTasksList(); } if (btn.classList.contains('claim-task-btn')) { btn.disabled = true; btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>'; try { await showMandatoryAdAfterAction(taskAdSettings); const reward = parseFloat(btn.dataset.reward); const inc = firebase.firestore.FieldValue.increment; await db.collection('users').doc(currentUser.uid).update({ balance: inc(reward), todayEarnings: inc(reward), totalEarnings: inc(reward), tasksCompleted: firebase.firestore.FieldValue.arrayUnion(taskKey) }); await addActivity('‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶™‡ßÅ‡¶∞‡¶∏‡ßç‡¶ï‡¶æ‡¶∞', reward); removeTaskFromClaim(taskId); alert(`‡¶Ö‡¶≠‡¶ø‡¶®‡¶®‡ßç‡¶¶‡¶®! ‡ß≥${reward.toFixed(2)} ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§`); } catch (error) { console.error("Task claim ad failed:", error); alert('‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡¶æ‡¶§‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§'); } finally { updateTasksList(); } } });
            
            const spinButton = document.getElementById('spin-wheel-btn'), wheel = document.getElementById('wheel'); let isSpinning = false;
            spinButton.addEventListener('click', async function() { if (isSpinning || spinPrizes.length === 0) return; const dailySpinLimit = appSettings.dailySpins || 3; if (userData.spinsUsed >= dailySpinLimit) { alert('‡¶Ü‡¶™‡¶®‡¶ø ‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶∏‡¶¨ ‡¶∏‡ßç‡¶™‡¶ø‡¶® ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßá‡¶õ‡ßá‡¶®!'); return; } isSpinning = true; spinButton.disabled = true; const prizeIndex = Math.floor(Math.random() * spinPrizes.length); const prizeAmount = spinPrizes[prizeIndex]; const sectionAngle = 360 / spinPrizes.length; const randomSpins = Math.floor(Math.random() * 5) + 5; const targetAngle = (randomSpins * 360) + (360 - (prizeIndex * sectionAngle) - (sectionAngle / 2)); wheel.style.transition = 'transform 6s cubic-bezier(0.1, 0.7, 0.0, 1)'; wheel.style.transform = `rotate(${targetAngle}deg)`; setTimeout(async () => { alert(`‡¶Ö‡¶≠‡¶ø‡¶®‡¶®‡ßç‡¶¶‡¶®! ‡¶Ü‡¶™‡¶®‡¶ø ‡ß≥${prizeAmount} ‡¶ú‡¶ø‡¶§‡ßá‡¶õ‡ßá‡¶®‡•§\n‡¶™‡ßÅ‡¶∞‡¶∏‡ßç‡¶ï‡¶æ‡¶∞ ‡¶™‡ßá‡¶§‡ßá ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®‡•§`); let adWasSuccessful = false; try { await showMandatoryAdAfterAction(spinAdSettings); adWasSuccessful = true; const inc = firebase.firestore.FieldValue.increment; await db.collection('users').doc(currentUser.uid).update({ balance: inc(prizeAmount), todayEarnings: inc(prizeAmount), totalEarnings: inc(prizeAmount), spinsUsed: inc(1) }); await addActivity('‡¶∏‡ßç‡¶™‡¶ø‡¶® ‡¶•‡ßá‡¶ï‡ßá ‡¶Ü‡¶Ø‡¶º', prizeAmount); alert(`‡¶∏‡¶´‡¶≤! ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü‡ßá ‡ß≥${prizeAmount.toFixed(2)} ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§`); } catch (error) { console.error("Spin ad failed:", error); alert('‡¶¶‡ßÅ‡¶É‡¶ñ‡¶ø‡¶§, ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶®‡¶ü‡¶ø ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§ ‡¶™‡ßÅ‡¶∞‡¶∏‡ßç‡¶ï‡¶æ‡¶∞ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶∏‡¶Æ‡ßç‡¶≠‡¶¨ ‡¶π‡¶Ø‡¶º‡¶®‡¶ø‡•§ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∏‡ßç‡¶™‡¶ø‡¶®‡¶ü‡¶ø ‡¶®‡¶∑‡ßç‡¶ü ‡¶π‡¶¨‡ßá ‡¶®‡¶æ, ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§'); } finally { wheel.style.transition = 'none'; wheel.style.transform = `rotate(${targetAngle % 360}deg)`; isSpinning = false; const spinsAfterAttempt = userData.spinsUsed + (adWasSuccessful ? 1 : 0); spinButton.disabled = spinsAfterAttempt >= dailySpinLimit; if (adWasSuccessful && spinsAfterAttempt >= dailySpinLimit) { alert('‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶∏‡ßç‡¶™‡¶ø‡¶® ‡¶∂‡ßá‡¶∑‡•§'); } } }, 6000); });

            const withdrawModal = document.getElementById('withdraw-modal');
            const showWithdrawModal = () => { withdrawModal.style.display = 'flex'; };
            document.getElementById('withdraw-btn-home').addEventListener('click', showWithdrawModal);
            document.getElementById('wallet-withdraw-btn').addEventListener('click', showWithdrawModal);
            document.getElementById('cancel-withdraw').addEventListener('click', () => withdrawModal.style.display = 'none');
            
            document.getElementById('withdraw-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                const amount = parseFloat(document.getElementById('withdraw-amount').value);
                const method = document.getElementById('withdraw-method').value;
                const number = document.getElementById('withdraw-number').value;

                const userReferrals = userData.referrals || 0;
                const userBalance = userData.balance || 0;
                const minReferrals = appSettings.minReferrals || 0;
                const minBalanceForWithdrawal = appSettings.minBalance || 0;
                const minWithdrawalAmount = appSettings.minWithdrawal || 50;

                let errorMessages = [];
                if (userReferrals < minReferrals) { errorMessages.push(`‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá ${minReferrals}‡¶ü‡¶ø ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®‡•§`); }
                if (userBalance < minBalanceForWithdrawal) { errorMessages.push(`‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá ‡ß≥${minBalanceForWithdrawal.toFixed(2)} ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§`); }
                if (isNaN(amount) || amount <= 0) { errorMessages.push(`‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶∏‡¶†‡¶ø‡¶ï ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®‡•§`); }
                if (amount < minWithdrawalAmount) { errorMessages.push(`‡¶Ü‡¶™‡¶®‡¶ø ‡¶∏‡¶∞‡ßç‡¶¨‡¶®‡¶ø‡¶Æ‡ßç‡¶® ‡ß≥${minWithdrawalAmount.toFixed(2)} ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®‡•§`); }
                if (amount > userBalance) { errorMessages.push(`‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü‡ßá ‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶§ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶®‡ßá‡¶á‡•§`); }

                if (errorMessages.length > 0) {
                    alert("‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶ï‡¶∞‡¶æ ‡¶∏‡¶Æ‡ßç‡¶≠‡¶¨ ‡¶®‡ßü:\n\n" + errorMessages.join("\n"));
                    return;
                }

                const btn = e.target.querySelector('button[type="submit"]');
                btn.disabled = true;
                try {
                    await db.runTransaction(async (t) => {
                        const userRef = db.collection('users').doc(currentUser.uid);
                        const withdrawalRef = db.collection('withdrawals').doc();
                        const userDoc = await t.get(userRef);
                        if (!userDoc.exists || userDoc.data().balance < amount) throw "Insufficient balance!";
                        t.set(withdrawalRef, { userId: currentUser.uid, userName: userData.name, amount, method, number, status: 'pending', timestamp: new Date().toISOString() });
                        t.update(userRef, { balance: firebase.firestore.FieldValue.increment(-amount) });
                    });
                    withdrawModal.style.display = 'none';
                    document.getElementById('withdraw-form').reset();
                    alert('‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®‡ßá‡¶∞ ‡¶Ö‡¶®‡ßÅ‡¶∞‡ßã‡¶ß ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!');
                } catch (error) {
                    console.error("Withdrawal failed:", error);
                    alert('‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®‡ßá‡¶∞ ‡¶Ö‡¶®‡ßÅ‡¶∞‡ßã‡¶ß ‡¶™‡¶æ‡¶†‡¶æ‡¶§‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§');
                } finally {
                    btn.disabled = false;
                }
            });
            
            document.getElementById('copy-link').addEventListener('click', () => navigator.clipboard.writeText(document.getElementById('referral-link').value).then(() => alert('‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!')));
            document.getElementById('logout-btn').addEventListener('click', () => auth.signOut());

            const supportModal = document.getElementById('support-modal'); const supportFab = document.getElementById('support-fab'); let scrollTimeout;
            supportFab.addEventListener('click', () => supportModal.style.display = 'flex');
            document.getElementById('close-support-modal').addEventListener('click', () => supportModal.style.display = 'none');
            window.addEventListener('scroll', () => { supportFab.classList.add('hidden'); clearTimeout(scrollTimeout); scrollTimeout = setTimeout(() => { supportFab.classList.remove('hidden'); }, 300); });
        });

        auth.onAuthStateChanged(async (user) => {
            if (user) {
                currentUser = user;
                await loadAppSettings();
                userData = await initializeUserData(user);
                if (userData.isBanned) { alert('‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü‡¶ü‡¶ø ‡¶∏‡¶æ‡¶∏‡¶™‡ßá‡¶®‡ßç‡¶° ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü‡ßá ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®‡•§'); auth.signOut(); return; }
                showMainApp();
                const adCollections = ['ad_networks', 'spin_ads', 'task_ads'];
                const [watchAdResult, spinAdResult, taskAdResult] = await Promise.all(adCollections.map(c => loadAdScriptsAndSettings(c)));
                adSettings = watchAdResult.ads;
                spinAdSettings = spinAdResult.ads;
                taskAdSettings = taskAdResult.ads;
                await Promise.all(adCollections.map(c => initializeAdNetworks(c)));
                listenToUserData(user.uid);
            } else {
                currentUser = null; userData = null; if (userListener) userListener();
                sessionStorage.removeItem('tasksToClaim');
                showAuthSection();
            }
        });
    </script>
</body>
</html>
